var B=Object.defineProperty;var U=(e,t,n)=>t in e?B(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var h=(e,t,n)=>(U(e,typeof t!="symbol"?t+"":t,n),n);const F=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const d of s)if(d.type==="childList")for(const y of d.addedNodes)y.tagName==="LINK"&&y.rel==="modulepreload"&&r(y)}).observe(document,{childList:!0,subtree:!0});function n(s){const d={};return s.integrity&&(d.integrity=s.integrity),s.referrerpolicy&&(d.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?d.credentials="include":s.crossorigin==="anonymous"?d.credentials="omit":d.credentials="same-origin",d}function r(s){if(s.ep)return;s.ep=!0;const d=n(s);fetch(s.href,d)}};F();const c={SERVER:{CREATED_PLAYER:"server-created-player"},PEER:{GENERATED_ANSWER:"peer-generated-answer",GENERATED_ICE_CANDIDATE:"peer-generated-ice-candidate",STARTED_ACCEPTING_CONNECTIONS:"peer-started-accepting-connections",STOPPED_ACCEPTING_CONNECTIONS:"peer-stopped-accepting-connections",WANTS_TO_JOIN:"peer-wants-to-join"},REMOTE:{GENERATED_ICE_CANDIDATE:"remote-generated-ice-candidate",SENDS_OFFER_AND_CANDIDATES:"host-sends-offer-and-candidates",SENDS_ANSWER:"remote-sends-answer",SENDS_ID:"remote-sends-id",DISCONNECTED:"remote-disconnected"},HANDSHAKE:"handshake",ERROR:"error"};function m(e,t={}){console.log(e,t);const n=document.querySelector("#log");n.innerHTML||(n.innerHTML=""),n.innerHTML+=`<p><b>${e}</b>: ${JSON.stringify(t)}</p>`}function O(){return"ru"}let W=document.body;const p={P2P_CHANNEL_OPENED:"p2p-channel-opened",ROUTE_CREATE_GAME_ENTERED:"route-create-game-entered",ROUTE_JOIN_GAME_ENTERED:"route-join-game-entered",MESSAGE_SENT:"message-sent",PEERCONNECTION_CLOSED:"peerconnection-closed"},l={on(e,t){W.addEventListener(e,t)},emit(e,t){return W.dispatchEvent(new CustomEvent(e,{detail:t}))}},E={ID:"id",READY_TO_GAME:"ready-to-game",READY_TO_REMATCH:"ready-to-rematch",ENEMY_GUESSED_WORD:"enemy-guessed-word",HOST_GENERATED_WORD:"host-generated-word",TIMER_TICK:"timer-tick",GAME_STOP:"game-stop"},T=document.querySelector(".notifier"),K=document.querySelector(".notifier__close");K.onpointerdown=e=>{_.close()};const A={GAME_OVER:"game-over",CREATE_GAME:"create-game",JOIN_GAME:"join-game"},_={open(e){var t,n;switch(e){case A.GAME_OVER:(t=document.querySelector(".notifier .winner[data-type='"+o.winner.type+"']"))==null||t.classList.add("active");break}(n=document.querySelector(".notifier__section[data-type='"+e+"']"))==null||n.classList.add("active"),T==null||T.classList.add("active")},close(){var e,t;T==null||T.classList.remove("active"),(e=document.querySelector(".notifier__section.active"))==null||e.classList.remove("active"),(t=document.querySelector(".notifier .winner.active"))==null||t.classList.remove("active"),document.querySelector(".invitation-copied").style.display="none",document.querySelector(".invitation-wait").style.display="none"}},o={mainWord:"",winner:"",words:{ru:{length:0,data:[]}},roundTime:99,wordRefreshTime:15,intervalId:0,loadDictionary:new Promise((e,t)=>{const n=O();fetch("/game-assets/dictionaries/"+n+"-sorted.txt").then(r=>r.json()).then(r=>{o.words[n].length=r.length,o.words[n].data=r,e()})}),start(){o.winner="",o.roundTime=99,o.wordRefreshTime=15,i.instances.me.reset(),i.instances.enemy.reset(),i.instances.me.type==="host"&&(o.refreshMainWord(),o.intervalId=setInterval(o.timerTick,1e3))},stop(){clearInterval(o.intervalId);const e=i.instances.me,t=i.instances.enemy;e.stamina<t.stamina?o.winner=t:e.stamina>t.stamina?o.winner=e:(e.stamina,t.stamina),_.open(A.GAME_OVER)},refreshMainWord(){o.loadDictionary.then(()=>{i.instances.me.clearCurrentWord();const e=o.words[O()].length,t=e-~~(e/5),n=~~(Math.random()*(e-t))+t;o.mainWord=o.words[O()].data[n],b({type:E.HOST_GENERATED_WORD,payload:{word:o.mainWord}}),o.refreshMainWordDOM()})},refreshMainWordDOM(){const e=document.querySelector(".main-word__letters"),t=Array.from(o.mainWord);let n="";t.forEach(r=>{n+=`<span class="main-word__letter">${r}</span>`}),e.innerHTML=n},timerTick(){o.roundTime--,o.wordRefreshTime--,o.wordRefreshTime===0&&(o.wordRefreshTime=15,o.refreshMainWord()),b({type:E.TIMER_TICK,payload:{roundTime:o.roundTime,wordRefreshTime:o.wordRefreshTime}}),o.updateTimersHTML()},updateTimersHTML(){document.querySelector(".round-timer").innerHTML=o.roundTime,document.querySelector(".refresh-word-info__timer").innerHTML=o.wordRefreshTime}};window.Game=o;const v={url:"game",onInit(){document.querySelector(".main-word__letters").onpointerdown=e=>{e.target.classList.contains("main-word__letter")&&(i.instances.me.currentWord+=e.target.textContent,i.instances.me.refreshCurrentWordDOM())},document.querySelector(".main-word__action[data-type='delete']").onpointerdown=()=>{i.instances.me.clearCurrentWord()},document.querySelector(".main-word__action[data-type='confirm']").onpointerdown=()=>{const e=i.instances.me,t=e.currentWord;o.words[O()].data.indexOf(t)>-1?(i.checkWordExistence(t)?e.guessWord():console.log("\u0441\u043B\u043E\u0432\u043E \u0443\u0436\u0435 \u0443\u0433\u0430\u0434\u0430\u043D\u043E"),e.clearCurrentWord()):(console.log("\u0441\u043B\u043E\u0432\u0430 \u043D\u0435 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u0435\u0442"),e.clearCurrentWord())},document.querySelector(".confirm-rematch").onpointerdown=()=>{i.instances.me.readyToRematch=!0,b({type:E.READY_TO_REMATCH}),i.checkReadyToRematch()}},onEnter(){var e;(e=document.querySelector(".section_game"))==null||e.classList.add("active"),o.start()},subscriptions:[]},N={url:"lobby",onInit(){document.querySelectorAll(".lobby-ready-button").forEach(t=>{t.onpointerdown=()=>{var n;t.dataset.type===((n=i.instances.me)==null?void 0:n.type)&&!t.classList.contains("activated")&&(t.classList.add("activated"),i.instances.me.readyToGame=!0,b({type:E.READY_TO_GAME}),i.checkReadyToGame())}})},onEnter(){var e,t;(e=document.querySelector(".section_lobby"))==null||e.classList.add("active"),(t=document.querySelector(".lobby-ready-button[data-type='"+i.instances.me.type+"'] .button"))==null||t.classList.add("active")},onLeave(){var e;(e=document.querySelector(".lobby-ready-button.activated"))==null||e.classList.remove("activated")},subscriptions:[]},D={url:"create-game",onInit(){document.querySelector(".copy-invitation.desktop").onpointerdown=()=>{var n;const e=(n=document.getElementById("game-id"))==null?void 0:n.textContent,t='\u0421\u044B\u0433\u0440\u0430\u0439 \u0441\u043E \u043C\u043D\u043E\u0439 \u0432 "\u041C\u0430\u0441-\u0420\u0435\u0441\u0442\u043B\u0438\u043D\u0433: \u0421\u043B\u043E\u0432\u0430"! https://illarionov.school/game#join-game&id=';navigator.clipboard.writeText(t+e).then(()=>{document.querySelector(".invitation-copied").style.display="inline-block"}),document.querySelector(".invitation-wait").style.display="block"},document.querySelector(".copy-invitation.mobile").onpointerdown=()=>{document.querySelector(".invitation-wait").style.display="block"}},onEnter(){var e;(e=document.querySelector(".section_lobby"))==null||e.classList.add("active"),_.open(A.CREATE_GAME),L.then(()=>{l.emit(p.ROUTE_CREATE_GAME_ENTERED),i.instances.me.type="host"})},onLeave(e){e.url!==N.url&&l.emit(p.PEERCONNECTION_CLOSED),R(c.PEER.STOPPED_ACCEPTING_CONNECTIONS),m(c.PEER.STOPPED_ACCEPTING_CONNECTIONS),_.close()},subscriptions:[]},I={url:"main-menu",onInit(){},onEnter(){var e;(e=document.querySelector(".section_main-menu"))==null||e.classList.add("active")},subscriptions:[]},G={url:"practice",onEnter(){var e;(e=document.querySelector(".section_game"))==null||e.classList.add("active")}},C=document.querySelector("#room-id-join");function k(e){l.emit(c.PEER.WANTS_TO_JOIN,{hostId:e}),i.instances.enemy.id=e,i.instances.enemy.type="host"}const P={url:"join-game",onInit(){document.querySelector("#join-room").onpointerdown=()=>{const e=C.value;k(e)}},onEnter(){var e;(e=document.querySelector(".section_lobby"))==null||e.classList.add("active"),_.open(A.JOIN_GAME),L.then(()=>{if(i.instances.me.type="client",l.emit(p.ROUTE_JOIN_GAME_ENTERED),location.hash.indexOf("&id")>-1){const t=location.hash.split("&")[1].split("=")[1];C.value=t,k(t)}})},onLeave(e){e.url!==N.url&&l.emit(p.PEERCONNECTION_CLOSED),_.close(),C.value=""},subscriptions:[]};let S,w;const f={[I.url]:I,[G.url]:G,[P.url]:P,[D.url]:D,[D.url]:D,[v.url]:v,[N.url]:N};var x,q;for(const e in f)f[e].onInit&&((q=(x=f[e]).onInit)==null||q.call(x)),f[e].subscriptions&&f[e].subscriptions.forEach(t=>{l.on(t.type,t.listener)});function H(){var t,n;let e="";if(location.hash){const r=(t=location.hash)==null?void 0:t.replace("#","").split("&")[0];f[r]&&(e=r)}e||(e="main-menu"),S=f[e],(n=document.querySelector(".section.active"))==null||n.classList.remove("active"),w&&w.onLeave&&w.onLeave(S),S.onEnter&&S.onEnter(w),w=S}function M(e){location.hash=e}l.on(p.P2P_CHANNEL_OPENED,()=>{M(N.url),m(p.P2P_CHANNEL_OPENED)});window.addEventListener("hashchange",H);const u=class{constructor(){h(this,"id");h(this,"type");h(this,"readyToGame",!1);h(this,"readyToRematch",!1);h(this,"currentWord","");h(this,"guessedWords",[]);h(this,"stamina",100)}reset(){this.clearCurrentWord(),this.guessedWords=[],this.refreshGuessedWordsDOM(),this.stamina=100,this.refreshStaminaDOM()}refreshCurrentWordDOM(){document.querySelector(".user-word").innerHTML=this.currentWord}clearCurrentWord(){this.currentWord="",this.refreshCurrentWordDOM()}refreshGuessedWordsDOM(){const t=document.querySelector(".player[data-type='"+this.type+"'] .word-list");let n="";this.guessedWords.forEach(r=>{n+=`<li>${r} </li>`}),t.innerHTML=n}decreaseStamina(t){this.stamina-=t.length*30,this.stamina<0&&(this.stamina=0),this.refreshStaminaDOM()}refreshStaminaDOM(){document.querySelector(".player[data-type='"+this.type+"'] .stamina__indicator").style.width=this.stamina+"%"}guessWord(){this.guessedWords.push(this.currentWord),this.refreshGuessedWordsDOM(),u.instances.enemy.decreaseStamina(this.currentWord),b({type:E.ENEMY_GUESSED_WORD,payload:{word:this.currentWord}}),u.instances.enemy.stamina<=0&&(o.stop(),b({type:E.GAME_STOP}))}static checkReadyToGame(){var t,n;((t=u.instances.me)==null?void 0:t.readyToGame)&&((n=u.instances.enemy)==null?void 0:n.readyToGame)&&(u.instances.me.readyToGame=!1,M(v.url))}static checkReadyToRematch(){var t,n;((t=u.instances.me)==null?void 0:t.readyToRematch)&&((n=u.instances.enemy)==null?void 0:n.readyToRematch)&&(u.instances.me.readyToRematch=!1,u.instances.enemy.readyToRematch=!1,_.close(),o.start())}static checkWordExistence(t){return u.instances.me.guessedWords.indexOf(t)<0&&u.instances.enemy.guessedWords.indexOf(t)<0&&t!==o.mainWord}};let i=u;h(i,"instances",{me:new u,enemy:new u});window.Player=i;const g=new WebSocket("wss://illarionov.school:8080");g.onopen=()=>{g.send(JSON.stringify({type:c.HANDSHAKE,payload:{id:localStorage.getItem("id")}}))};g.onclose=e=>{m("socket.close",e)};g.onerror=e=>{m("socket.error",e)};const L=new Promise(e=>{g.onmessage=({data:t})=>{const n=JSON.parse(t),r=n.type,s=n.payload;if(r===c.SERVER.CREATED_PLAYER){const d='\u0421\u044B\u0433\u0440\u0430\u0439 \u0441\u043E \u043C\u043D\u043E\u0439 \u0432 "\u041C\u0430\u0441-\u0420\u0435\u0441\u0442\u043B\u0438\u043D\u0433: \u0421\u043B\u043E\u0432\u0430"! https://illarionov.school/game%23join-game%26id=',{id:y}=s;localStorage.setItem("id",y),document.querySelector("#game-id").innerHTML=y,document.querySelector(".copy-invitation.mobile").href="whatsapp://send?text="+d+y,i.instances.me.id=y,m(c.SERVER.CREATED_PLAYER,y),e(!0);return}else r===c.ERROR&&m(c.ERROR,s);l.emit(r,s)}});function R(e,t={}){L.then(()=>{g.send(JSON.stringify({type:e,payload:t}))})}let a=null;l.on(p.ROUTE_CREATE_GAME_ENTERED,async()=>{if(J(),a){Y(a.createDataChannel("game"));const e=await a.createOffer();a.setLocalDescription(e),R(c.PEER.STARTED_ACCEPTING_CONNECTIONS,{offer:e}),m(c.PEER.STARTED_ACCEPTING_CONNECTIONS)}});l.on(p.ROUTE_JOIN_GAME_ENTERED,async()=>{J()});l.on(p.PEERCONNECTION_CLOSED,()=>{j()});l.on(c.REMOTE.GENERATED_ICE_CANDIDATE,({detail:e})=>{const{iceCandidate:t}=e;a.addIceCandidate(t),m(c.REMOTE.GENERATED_ICE_CANDIDATE,t)});l.on(c.REMOTE.SENDS_ANSWER,({detail:e})=>{const{answer:t}=e;a.setRemoteDescription(t),m(c.REMOTE.SENDS_ANSWER)});l.on(c.PEER.WANTS_TO_JOIN,({detail:e})=>{R(c.PEER.WANTS_TO_JOIN,e),a.ondatachannel=t=>{Y(t.channel)}});l.on(c.REMOTE.SENDS_OFFER_AND_CANDIDATES,async({detail:e})=>{const{offer:t,iceCandidates:n}=e;if(a){await a.setRemoteDescription(t),n.forEach(s=>{a.addIceCandidate(s)});const r=await a.createAnswer();a.setLocalDescription(r),R(c.PEER.GENERATED_ANSWER,{answer:r}),m(c.REMOTE.SENDS_OFFER_AND_CANDIDATES)}});l.on(c.REMOTE.SENDS_ID,({detail:e})=>{const{enemyId:t}=e;i.instances.enemy.id=t,i.instances.enemy.type="client"});function J(){a=new RTCPeerConnection({iceServers:[{urls:["stun:stun.illarionov.school"]},{urls:["turn:turn.illarionov.school:5349"],username:"maswrestlinggame",credential:"sakhaforthewin"}]}),a.onicecandidate=({candidate:e})=>{R(c.PEER.GENERATED_ICE_CANDIDATE,{iceCandidate:e}),m(c.PEER.GENERATED_ICE_CANDIDATE,e)},a.oniceconnectionstatechange=()=>{a&&a.iceConnectionState==="disconnected"&&(m("iceConnectionState",a.iceConnectionState),R(c.REMOTE.DISCONNECTED),j(),M(I.url))}}function j(){a&&(a.close(),a=null)}function Y(e){e.onmessage=t=>{const n=JSON.parse(t.data),r=i.instances.enemy,s=i.instances.me;switch(n.type){case E.READY_TO_GAME:const d=document.querySelector(".lobby-ready-button[data-player='"+r.type+"']");r.readyToGame=!0,d==null||d.classList.remove("lobby-ready-button-notready"),d==null||d.classList.add("lobby-ready-button-ready"),i.checkReadyToGame();break;case E.READY_TO_REMATCH:r.readyToRematch=!0,i.checkReadyToRematch();break;case E.HOST_GENERATED_WORD:o.mainWord=n.payload.word,o.refreshMainWordDOM();break;case E.TIMER_TICK:o.roundTime=n.payload.roundTime,o.wordRefreshTime=n.payload.wordRefreshTime,o.updateTimersHTML();break;case E.ENEMY_GUESSED_WORD:r.guessedWords.push(n.payload.word),r.refreshGuessedWordsDOM(),s.decreaseStamina(n.payload.word);break;case E.GAME_STOP:o.stop();break}m("message",n)},e.onopen=t=>{l.emit(p.P2P_CHANNEL_OPENED),m("channel.open",t)},e.onclose=t=>m("channel.close",t),a.channel=e}function b(e){a.channel.send(JSON.stringify(e))}window.peerConnection=a;H();o.loadDictionary;
